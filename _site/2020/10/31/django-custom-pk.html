<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1">

<title>Working With Custom Primary Key in Django Models | Ritij Jain</title>

<meta name="description" content="Computer science major at Penn State with an interest in robotics, data science, and full-stack software development.
">
<meta name="keywords" content="#tips, #django">
<link rel="canonical" href="/2020/10/31/django-custom-pk.html">

<!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-171410516-1"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-171410516-1');
</script>


<!--Feature assets-->
<!--Bootstrap JS-->
<script src="https://code.jquery.com/jquery-3.5.1.slim.min.js" integrity="sha384-DfXdz2htPH0lsSSs5nCTpuj/zy4C+OGpamoFVy38MVBnE+IbbVYUew+OrCXaRkfj" crossorigin="anonymous"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@4.5.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-ho+j7jyWK8fNQe+A12Hb8AhRq26LrZ/JpcUGGOn+Y7RsweNrtN/tE3MoK7ZeZDyx" crossorigin="anonymous"></script>

<!--Font Awesome-->
<link rel="stylesheet" href="https://pro.fontawesome.com/releases/v5.10.0/css/all.css" integrity="sha384-AYmEC3Yw5cVb3ZcuHtOA93w35dYTsvhLPVnYs9eStHfGJvOvKxVfELGroGkvsg+p" crossorigin="anonymous"/>

<!--Highlight.js-->
<link rel="stylesheet" href="//cdn.jsdelivr.net/gh/highlightjs/cdn-release@10.3.2/build/styles/default.min.css">
<script src="//cdn.jsdelivr.net/gh/highlightjs/cdn-release@10.3.2/build/highlight.min.js"></script>
<script>hljs.initHighlightingOnLoad();</script>

<!--Main assets-->
<link rel="icon" type="image/jpeg" href="/favicon.png"/>
<link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css" integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous">
<link rel="stylesheet" href="/assets/css/main.css">
</head>
<body>
<div class="wrapper">
<header class="header">
<div class="navigation">
<a href="/" class="logo">Ritij Jain</a>
<ul class="menu">
<li class="menu__entry"><a href="/">about</a></li>
<li class="menu__entry"><a href="/projects">projects</a></li>
<li class="menu__entry"><a href="/posts">posts</a></li>
</ul>
</div>
<ul class="social-links">

<a href="mailto:ritij@ritijjain.com" class="social-links__entry" target="_blank">
<i class="fas fa-envelope-square"></i>
</a>


<a href="https://github.com/ritijjain" class="social-links__entry" target="_blank">
<i class="fab fa-github"></i>
</a>


<a href="https://in.linkedin.com/in/ritijjain" class="social-links__entry" target="_blank">
<i class="fab fa-linkedin-in"></i>
</a>

</ul>
</header>
<br>
<br>
<h1 class="post-title">
    <div class="post-title__text">Working With Custom Primary Key in Django Models</div>
</h1>
<p class="post-title__subtitle">Published Oct 31, 2020  by <a href="https://ritijjain.com/">Ritij Jain<a><br />


    <span class="badge badge-info">#tips</span>

    <span class="badge badge-info">#django</span>

<hr>
<br>
<p>Usually, Django automatically adds an integer <code class="highlighter-rouge">id</code> field to every model, this acts as an auto-incrementing primary key for every object of the model. This means objects of this model can be accessed one by one when they are called by their integer primary key e.g. <code class="highlighter-rouge">get_object_or_404(Model, pk=1)</code> returns the first object of the Model, <code class="highlighter-rouge">get_object_or_404(Model, pk=2)</code> returns the second object of the Model and so on.</p>

<p>This is ok for most cases, but some situations might require a primary key which does not follow this convention. For example, YouTube uses a unique 11 digit base64 id for their videos which makes it harder for web scrapers to loop over every YouTube video which may reveal unlisted videos.</p>

<p>Fortunately, Django supports overriding the built in integer primary key by setting <code class="highlighter-rouge">primary_key=True</code> for any model field.</p>

<p>To implement custom primary key, start with creating a function which returns a unique ID in your desired format. It is important that this function does not take in any variables because we want to preserve the ability to pass this function as an argument without executing it. For organization purposes, it is a good idea to keep any such functions in a separate <code class="highlighter-rouge">utils.py</code> file.</p>

<p><code class="highlighter-rouge">\utils.py</code></p>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">import</span> <span class="nn">secrets</span>

<span class="k">def</span> <span class="nf">custom_id</span><span class="p">():</span>
    <span class="k">return</span> <span class="n">secrets</span><span class="p">.</span><span class="n">token_urlsafe</span><span class="p">(</span><span class="mi">8</span><span class="p">)</span>
</code></pre></div></div>

<p>Now simply add a <code class="highlighter-rouge">CharField</code> to your model and set <code class="highlighter-rouge">primary_key=True</code>. Now we can just set <code class="highlighter-rouge">default=custom_id</code> which would pass in the custom id generating function we just created as the default value for the <code class="highlighter-rouge">custom_id</code> field. Note that we are passing in <code class="highlighter-rouge">custom_id</code> function without the brackets <code class="highlighter-rouge">()</code>. This is important as it insures the function executes every time a new object of this model is created resulting in unique id for each object. The primary key can be optionally made uneditable by setting <code class="highlighter-rouge">editable=False</code>.</p>

<p><code class="highlighter-rouge">\models.py</code></p>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">import</span> <span class="nn">secrets</span>
<span class="kn">from</span> <span class="nn">.utils</span> <span class="kn">import</span> <span class="n">custom_id</span>

<span class="k">class</span> <span class="nc">MyModel</span><span class="p">(</span><span class="n">models</span><span class="p">.</span><span class="n">Model</span><span class="p">):</span>
    <span class="n">custom_id</span> <span class="o">=</span> <span class="n">models</span><span class="p">.</span><span class="n">CharField</span><span class="p">(</span><span class="n">primary_key</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">max_length</span><span class="o">=</span><span class="mi">11</span><span class="p">,</span> <span class="n">unique</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="n">custom_id</span><span class="p">)</span>
</code></pre></div></div>

<br>

<div id="disqus_thread"></div>
<script>


var disqus_config = function () {
this.page.url = 'http://localhost:4000/assets/style.css';
this.page.identifier = '/2020/10/31/django-custom-pk.html'; 
};

(function() {
var d = document, s = d.createElement('script');
s.src = 'https://ritijjain.disqus.com/embed.js';
s.setAttribute('data-timestamp', +new Date());
(d.head || d.body).appendChild(s);
})();
</script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
                            

<br>
<div class="about">
<div class="about__devider">*****</div>
<div class="about__text">
<br>
&#169 2020, Ritij Jain | <a href="https://github.com/ritijjain/pudhina-fresh">Pudhina Fresh</a> theme for Jekyll.
</div>
</div>
</div>
</body>
</html>